import{v as C}from"./runtime-dom.esm-bundler-cc91c085.js";import{_ as y,k as b,l as r,V as l,W as t,a0 as f,a3 as g,$ as c,a4 as _,Y as x,Z as k,a5 as v,a1 as w}from"./_plugin-vue_export-helper-705f5c90.js";const{VITE_APP_URL:h,VITE_APP_PATH:u}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"2259buyer",BASE_URL:"/VueTraining_w7/",MODE:"production",DEV:!1,PROD:!0},T={data(){return{categorys:["精選套餐","現烤總匯","漢堡","現烤三明治","蛋餅、河粉蛋餅","中西式點心"],selectedCategorys:[],selectdeProducts:[],checkAll:!1,canStartLottery:!1,winner:null,products:[],productID:"",carts:{},finalTotal:"",loadingItem:""}},methods:{onCheckAllChange(){this.selectedCategorys=this.checkAll?[...this.categorys]:[]},watchSelectedCategorys(){this.selectedCategorys.length===0||this.selectedCategorys.length===this.categorys.length?this.checkAll=!0:this.checkAll=!1},startLottery(){let e=20;const o=2e3,p=20,d=100;let a=0;const n=setInterval(()=>{const m=Math.floor(Math.random()*this.products.length),s=this.products[m];if(this.winner=s,console.log(n,this.winner),a<d&&(e+=p,a++),e>=o){clearInterval(n);const{id:i}=this.winner;this.addToCart(i)}},e)},getProduct(){this.$http.get(`${h}/v2/api/${u}/products/all`).then(e=>{this.products=e.data.products}).catch(e=>{this.swalError(e)})},addToCart(e,o=1){const p={product_id:e,qty:o,message:"抽抽樂抽到的"};this.$http.post(`${h}/v2/api/${u}/cart`,{data:p}).then(d=>{this.swalToastTopEnd("已幫您自動加入購物車"),this.getCartData()}).catch(d=>{this.swalError(d)})},getCartData(){this.$http.get(`${h}/v2/api/${u}/cart`).then(e=>{this.carts=e.data.data.carts,this.finalTotal=e.data.data.final_total}).catch(e=>{this.swalError(e)})},deleteOneCart(e=null){this.loadingItem=e,this.$http.delete(`${h}/v2/api/${u}/cart/${e}`).then(o=>{this.swalToastTopEnd(o.data.message),this.loadingItem="",this.getCartData()}).catch(o=>{this.swalError(o)})},swalClearCart(){this.$swal({title:"真的要清掉已選好商品嗎？",text:"清除後，只能重新挑選商品，無法復原唷 :(",icon:"warning",showCancelButton:!0,confirmButtonText:"堅決清空重來",cancelButtonText:"先不用"}).then(e=>{e.isConfirmed&&this.cleanAllCart()})},cleanAllCart(){this.$http.delete(`${h}/v2/api/${u}/carts`).then(e=>{this.$swal("購物車已清空，重新選新的餐點吧！"),this.$router.push("/products")}).catch(e=>{this.swalError(e)})},swalToastTopEnd(e){this.$swal({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e4,icon:"success",title:e})},swalError(e){this.$swal({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",toast:!0,icon:"error",title:e,text:"請重新操作，若再次出現請通知管理者，謝謝"})}},mounted(){this.getProduct(),this.getCartData(),document.title="鮮堡漢堡 文化店 | 早餐轉轉轉"}},E={class:"w-100 position-relative z-2"},A=t("section",{class:"common-hero container"},[t("h2",{class:"mb-1ls-2 text-sm-start text-center"}," 不知道吃什麼嗎？我也許能幫忙！ "),t("h1",{class:"text-secondary text-nowrap font-monospace text-uppercase mb-1"}," make life smoother ")],-1),P={class:"container"},V={class:"row row-cols-1 row-cols-lg-2 p-1 pb-6"},I={class:"col"},B={class:"row justify-content-center bg-third rounded rounded-4 rounded-lg-5 p-4 p-md-6"},D=t("h5",null,"有特別想要的餐點類別嗎？（預設全選）",-1),S={class:"form-group mb-2"},L=t("div",{class:"form-check"},null,-1),$=["id","value"],U=["for"],O={key:0,class:"mt-5 fs-5"},M={class:"col"},N={class:"table align-middle w-100 border-secondary p-2"},R=t("thead",null,[t("tr",{class:"w-100"},[t("th",null,"品名"),t("th",{class:"text-nowrap text-center"},"單價"),t("th",{class:"text-nowrap text-center"},"數量"),t("th",{class:"text-nowrap text-center"},"小計"),t("th")])],-1),j={class:"w-100"},H={key:0,class:"text-success"},q={class:"text-center"},z={class:"text-center"},F={class:"text-center"},K=["onClick","disabled"],W={key:0,class:"fas fa-spinner fa-pulse"},Y={class:"border-transparent"},Z=t("td",{colspan:"4",class:"text-end border-0"},"總計",-1),G={class:"text-end border-0"},J={class:"d-flex justify-content-between mb-4"};function Q(e,o,p,d,a,n){const m=b("router-link");return r(),l("main",E,[A,t("section",P,[t("div",V,[t("div",I,[t("div",B,[D,t("div",S,[L,(r(!0),l(f,null,g(a.categorys,s=>(r(),l("div",{class:"form-check",key:s},[v(t("input",{class:"form-check-input",type:"checkbox",id:s,value:s,"onUpdate:modelValue":o[0]||(o[0]=i=>a.selectedCategorys=i),onChange:o[1]||(o[1]=(...i)=>n.watchSelectedCategorys&&n.watchSelectedCategorys(...i))},null,40,$),[[C,a.selectedCategorys]]),t("label",{class:"form-check-label",for:s},c(s),9,U)]))),128))]),t("button",{class:"btn btn-primary",onClick:o[2]||(o[2]=(...s)=>n.startLottery&&n.startLottery(...s))},"按我開始，決定今天吃什麼 "),a.winner?(r(),l("div",O," 您覺得今天吃 『 "+c(a.winner.mainTitle)+" 』 好嗎？ ",1)):_("",!0)])]),t("div",M,[t("table",N,[R,t("tbody",j,[a.carts?(r(!0),l(f,{key:0},g(a.carts,s=>(r(),l("tr",{key:s.id},[t("td",null,[w(c(s.product.title)+" ",1),s.coupon?(r(),l("div",H," 已套用優惠券 ")):_("",!0)]),t("td",q,c(s.product.price),1),t("td",z,c(s.qty),1),t("td",F,c(s.total),1),t("td",null,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:i=>n.deleteOneCart(s.id),disabled:s.id===a.loadingItem},[a.loadingItem===s.id?(r(),l("i",W)):_("",!0),w(" x ")],8,K)])]))),128)):_("",!0)]),t("tfoot",Y,[t("tr",null,[Z,t("td",G,c(a.finalTotal),1)])])]),t("div",J,[t("button",{class:"btn btn-danger",type:"button",onClick:o[3]||(o[3]=(...s)=>n.swalClearCart&&n.swalClearCart(...s))}," 清空商品 "),x(m,{class:"btn btn-secondary",type:"button",to:"/products"},{default:k(()=>[w("想點更多")]),_:1})])])])])])}const et=y(T,[["render",Q]]);export{et as default};
